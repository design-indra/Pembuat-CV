<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CV Generator AI</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Sans:wght@300;400;500;600&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root{--ink:#1a1a2e;--paper:#f5f0e8;--gold:#c9a84c;--gold-light:#e8d5a3;--accent:#2d5a8e}
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'DM Sans',sans-serif;background:var(--ink);color:var(--paper);min-height:100vh}
  body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 80% 50% at 20% 20%,rgba(201,168,76,.08) 0%,transparent 60%),radial-gradient(ellipse 60% 80% at 80% 80%,rgba(45,90,142,.12) 0%,transparent 60%);pointer-events:none;z-index:0}
  header{position:relative;z-index:10;text-align:center;padding:40px 20px 24px;border-bottom:1px solid rgba(201,168,76,.2)}
  .logo-tag{display:inline-block;font-size:11px;letter-spacing:4px;text-transform:uppercase;color:var(--gold);margin-bottom:10px;opacity:.8}
  header h1{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,5vw,3.5rem);font-weight:900;background:linear-gradient(135deg,var(--paper) 30%,var(--gold) 70%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
  header p{margin-top:8px;color:rgba(245,240,232,.5);font-size:.9rem}
  .container{position:relative;z-index:10;max-width:1200px;margin:0 auto;padding:28px 16px 80px;display:grid;grid-template-columns:1fr 1fr;gap:28px;align-items:start}
  @media(max-width:800px){.container{grid-template-columns:1fr}}
  .form-panel{background:rgba(245,240,232,.04);border:1px solid rgba(201,168,76,.15);border-radius:20px;padding:24px;backdrop-filter:blur(10px)}
  .panel-title{font-family:'Playfair Display',serif;font-size:1.1rem;color:var(--gold);margin-bottom:20px;display:flex;align-items:center;gap:10px}
  .panel-title::after{content:'';flex:1;height:1px;background:rgba(201,168,76,.2)}
  .section-label{font-size:10px;letter-spacing:3px;text-transform:uppercase;color:var(--gold);opacity:.6;margin-bottom:8px;margin-top:18px}
  .form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .form-group{display:flex;flex-direction:column;gap:5px;margin-bottom:10px}
  label{font-size:12px;color:rgba(245,240,232,.5)}
  input,select,textarea{background:rgba(245,240,232,.06);border:1px solid rgba(201,168,76,.15);border-radius:10px;padding:10px 13px;color:var(--paper);font-family:'DM Sans',sans-serif;font-size:14px;transition:all .2s;width:100%}
  input::placeholder,textarea::placeholder{color:rgba(245,240,232,.2)}
  input:focus,select:focus,textarea:focus{outline:none;border-color:rgba(201,168,76,.5);background:rgba(245,240,232,.08)}
  select option{background:var(--ink)}
  textarea{resize:vertical;min-height:70px}

  /* FOTO */
  .foto-upload-area{border:2px dashed rgba(201,168,76,.3);border-radius:14px;padding:16px;text-align:center;cursor:pointer;transition:all .2s;position:relative;overflow:hidden;min-height:80px}
  .foto-upload-area:hover{border-color:rgba(201,168,76,.6);background:rgba(201,168,76,.05)}
  .foto-preview{width:90px;height:90px;border-radius:50%;object-fit:cover;border:3px solid var(--gold);margin:0 auto 8px;display:block}
  .foto-placeholder{color:rgba(245,240,232,.4);font-size:13px}
  .foto-placeholder span{font-size:28px;display:block;margin-bottom:4px}
  #foto-input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
  .btn-hapus-foto{font-size:11px;color:#e8a0a0;background:rgba(142,45,45,.2);border:1px solid rgba(142,45,45,.3);border-radius:6px;padding:4px 12px;cursor:pointer;margin-top:6px;font-family:'DM Sans',sans-serif;display:none}

  /* TEMPLATE */
  .template-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  .template-card{border:2px solid rgba(201,168,76,.15);border-radius:12px;padding:10px 6px;cursor:pointer;text-align:center;transition:all .2s;background:rgba(245,240,232,.03)}
  .template-card:hover{border-color:rgba(201,168,76,.4)}
  .template-card.active{border-color:var(--gold);background:rgba(201,168,76,.1)}
  .template-thumb{width:100%;height:55px;border-radius:6px;margin-bottom:6px;position:relative;overflow:hidden}
  .t1-thumb{background:linear-gradient(135deg,#1a1a2e 40%,#2d3561 100%)}
  .t2-thumb{background:linear-gradient(135deg,#1a4a2e 40%,#2d6b45 100%)}
  .t3-thumb{background:linear-gradient(135deg,#4a1a2e 40%,#8e2d5a 100%)}
  .template-thumb::after{content:'';position:absolute;bottom:0;left:0;right:0;height:40%;background:white;opacity:.9}
  .template-name{font-size:11px;color:rgba(245,240,232,.7);font-weight:500}
  .template-card.active .template-name{color:var(--gold)}

  /* DYNAMIC */
  .dynamic-list{display:flex;flex-direction:column;gap:8px}
  .dynamic-item{display:flex;gap:8px;align-items:center}
  .dynamic-item input{flex:1}
  .btn-remove{background:rgba(142,45,45,.2);border:1px solid rgba(142,45,45,.3);color:#e8a0a0;border-radius:8px;width:32px;height:32px;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
  .btn-remove:hover{background:rgba(142,45,45,.4)}
  .btn-add{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:var(--gold);background:rgba(201,168,76,.08);border:1px dashed rgba(201,168,76,.3);border-radius:8px;padding:6px 14px;cursor:pointer;transition:all .2s;margin-top:6px;font-family:'DM Sans',sans-serif}
  .btn-add:hover{background:rgba(201,168,76,.15)}
  .btn-generate{width:100%;padding:15px;margin-top:20px;background:linear-gradient(135deg,var(--gold) 0%,#a07830 100%);color:var(--ink);border:none;border-radius:12px;font-family:'DM Sans',sans-serif;font-size:15px;font-weight:600;cursor:pointer;transition:all .3s}
  .btn-generate:hover{transform:translateY(-2px);box-shadow:0 12px 40px rgba(201,168,76,.35)}
  .btn-generate:disabled{opacity:.5;cursor:not-allowed;transform:none}
  .status-msg{text-align:center;font-size:13px;color:var(--gold);margin-top:10px;min-height:20px;opacity:0;transition:opacity .3s}
  .status-msg.visible{opacity:1}

  /* CV PANEL */
  .cv-panel{position:sticky;top:20px}
  .cv-wrapper{background:white;border-radius:20px;overflow:hidden;box-shadow:0 30px 80px rgba(0,0,0,.4);min-height:400px;display:flex;align-items:center;justify-content:center}
  .cv-placeholder{text-align:center;padding:60px 30px;color:rgba(26,26,46,.3)}
  .cv-placeholder p{font-size:14px;color:rgba(26,26,46,.4);margin-top:12px}
  #cv-content{width:100%;color:#1a1a2e}
  .cv-actions{display:flex;gap:10px;margin-top:14px}
  .btn-action{flex:1;padding:12px;border-radius:10px;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;border:none}
  .btn-download{background:linear-gradient(135deg,var(--gold) 0%,#a07830 100%);color:var(--ink)}
  .btn-print{background:rgba(245,240,232,.08);border:1px solid rgba(201,168,76,.2)!important;color:var(--paper)}

  /* TEMPLATE 1 - NAVY */
  .t1 .cv-header-bar{background:linear-gradient(135deg,#1a1a2e,#2d3561);padding:28px;color:white;display:flex;gap:20px;align-items:center}
  .t1 .cv-foto{width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid #c9a84c;flex-shrink:0}
  .t1 .cv-foto-placeholder{width:80px;height:80px;border-radius:50%;background:rgba(255,255,255,.1);border:3px solid rgba(201,168,76,.4);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:28px}
  .t1 .cv-name{font-family:'Playfair Display',serif;font-size:24px;font-weight:700;color:white}
  .t1 .cv-title{color:#e8d5a3;font-size:12px;letter-spacing:2px;text-transform:uppercase;margin-top:4px}
  .t1 .cv-section-title{font-size:9px;letter-spacing:3px;text-transform:uppercase;color:#2d5a8e;font-weight:700;margin-bottom:8px;padding-bottom:4px;border-bottom:2px solid #2d5a8e}
  .t1 .cv-section-title-side{font-size:9px;letter-spacing:3px;text-transform:uppercase;color:#8a7040;font-weight:700;margin-bottom:8px;padding-bottom:4px;border-bottom:2px solid #c9a84c}
  .t1 .cv-skill-tag{background:rgba(45,90,142,.1);color:#2d5a8e;padding:3px 9px;border-radius:20px;font-size:10px;font-weight:500}
  .t1 .cv-lang-level{color:#2d5a8e;font-weight:500}

  /* TEMPLATE 2 - GREEN */
  .t2 .cv-header-bar{background:linear-gradient(135deg,#1a4a2e,#2d6b45);padding:28px;color:white;display:flex;gap:20px;align-items:center}
  .t2 .cv-foto{width:80px;height:80px;border-radius:12px;object-fit:cover;border:3px solid #7ecca0;flex-shrink:0}
  .t2 .cv-foto-placeholder{width:80px;height:80px;border-radius:12px;background:rgba(255,255,255,.1);border:3px solid rgba(126,204,160,.4);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:28px}
  .t2 .cv-name{font-family:'Poppins',sans-serif;font-size:24px;font-weight:700;color:white}
  .t2 .cv-title{color:#a8e6c3;font-size:12px;letter-spacing:1px;margin-top:4px;font-weight:300}
  .t2 .cv-section-title{font-size:9px;letter-spacing:3px;text-transform:uppercase;color:#2d6b45;font-weight:700;margin-bottom:8px;padding-bottom:4px;border-bottom:2px solid #2d6b45}
  .t2 .cv-section-title-side{font-size:9px;letter-spacing:3px;text-transform:uppercase;color:#2d6b45;font-weight:700;margin-bottom:8px;padding-bottom:4px;border-bottom:2px solid #7ecca0}
  .t2 .cv-skill-tag{background:rgba(45,107,69,.1);color:#2d6b45;padding:3px 9px;border-radius:20px;font-size:10px;font-weight:500}
  .t2 .cv-lang-level{color:#2d6b45;font-weight:500}

  /* TEMPLATE 3 - ROSE */
  .t3 .cv-header-bar{background:linear-gradient(135deg,#4a1a2e,#8e2d5a);padding:28px;color:white;display:flex;gap:20px;align-items:center}
  .t3 .cv-foto{width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid #f0a0c0;flex-shrink:0}
  .t3 .cv-foto-placeholder{width:80px;height:80px;border-radius:50%;background:rgba(255,255,255,.1);border:3px solid rgba(240,160,192,.4);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:28px}
  .t3 .cv-name{font-family:'Playfair Display',serif;font-size:24px;font-weight:700;color:white;font-style:italic}
  .t3 .cv-title{color:#f0c0d4;font-size:12px;letter-spacing:2px;margin-top:4px}
  .t3 .cv-section-title{font-size:9px;letter-spacing:3px;text-transform:uppercase;color:#8e2d5a;font-weight:700;margin-bottom:8px;padding-bottom:4px;border-bottom:2px solid #8e2d5a}
  .t3 .cv-section-title-side{font-size:9px;letter-spacing:3px;text-transform:uppercase;color:#8e2d5a;font-weight:700;margin-bottom:8px;padding-bottom:4px;border-bottom:2px solid #f0a0c0}
  .t3 .cv-skill-tag{background:rgba(142,45,90,.1);color:#8e2d5a;padding:3px 9px;border-radius:20px;font-size:10px;font-weight:500}
  .t3 .cv-lang-level{color:#8e2d5a;font-weight:500}

  /* SHARED CV */
  .cv-contact-bar{display:flex;flex-wrap:wrap;gap:12px;margin-top:12px}
  .cv-contact-item{display:flex;align-items:center;gap:4px;font-size:11px;color:rgba(255,255,255,.75)}
  .cv-body{padding:22px 28px;display:grid;grid-template-columns:1fr 2fr;gap:22px;font-family:'DM Sans',sans-serif}
  .cv-section{margin-bottom:18px}
  .cv-summary{font-size:12px;line-height:1.7;color:#444}
  .cv-exp-item{margin-bottom:14px}
  .cv-exp-role{font-weight:600;font-size:13px;color:#1a1a2e}
  .cv-exp-company{font-size:12px;color:#666;font-weight:500}
  .cv-exp-period{font-size:11px;color:#999;margin-bottom:4px}
  .cv-exp-desc{font-size:11px;color:#555;line-height:1.6}
  .cv-skill-list{display:flex;flex-wrap:wrap;gap:5px}
  .cv-edu-item{margin-bottom:10px}
  .cv-edu-degree{font-weight:600;font-size:12px;color:#1a1a2e}
  .cv-edu-school{font-size:11px;color:#666}
  .cv-edu-year{font-size:10px;color:#999}
  .cv-lang-item{display:flex;justify-content:space-between;font-size:11px;margin-bottom:5px;color:#444}

  @media print{body{background:white}.form-panel,header,.cv-actions{display:none}.container{display:block;padding:0}.cv-panel{position:static}.cv-wrapper{box-shadow:none;border-radius:0}}
</style>
</head>
<body>
<header>
  <div class="logo-tag">‚ú¶ Powered by Groq AI</div>
  <h1>CV Generator AI</h1>
  <p>Isi data Anda ‚Äî AI otomatis membuat CV profesional lengkap</p>
</header>

<div class="container">
  <div class="form-panel">
    <div class="panel-title">Data Diri</div>

    <div class="section-label">üì∑ Foto Profil</div>
    <div class="foto-upload-area" id="foto-area" onclick="document.getElementById('foto-input').click()">
      <input type="file" id="foto-input" accept="image/*" onchange="handleFoto(event)">
      <div id="foto-placeholder" class="foto-placeholder">
        <span>üì∑</span>Tap untuk upload foto dari galeri HP
      </div>
      <div id="foto-preview-wrap" style="display:none">
        <img id="foto-preview" class="foto-preview" src="" alt="Foto">
        <div style="font-size:11px;color:rgba(245,240,232,.5)">Tap untuk ganti foto</div>
      </div>
    </div>
    <button class="btn-hapus-foto" id="btn-hapus-foto" onclick="hapusFoto(event)">√ó Hapus Foto</button>

    <div class="section-label">üé® Pilih Template</div>
    <div class="template-grid">
      <div class="template-card active" onclick="pilihTemplate(1)" id="tpl-1">
        <div class="template-thumb t1-thumb"></div>
        <div class="template-name">üîµ Navy Classic</div>
      </div>
      <div class="template-card" onclick="pilihTemplate(2)" id="tpl-2">
        <div class="template-thumb t2-thumb"></div>
        <div class="template-name">üü¢ Green Modern</div>
      </div>
      <div class="template-card" onclick="pilihTemplate(3)" id="tpl-3">
        <div class="template-thumb t3-thumb"></div>
        <div class="template-name">üå∏ Rose Elegant</div>
      </div>
    </div>

    <div class="section-label">Informasi Pribadi</div>
    <div class="form-row">
      <div class="form-group"><label>Nama Lengkap *</label><input type="text" id="nama" placeholder="Budi Santoso"/></div>
      <div class="form-group"><label>Tanggal Lahir</label><input type="date" id="tgl_lahir"/></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Email *</label><input type="email" id="email" placeholder="budi@email.com"/></div>
      <div class="form-group"><label>Nomor HP</label><input type="tel" id="telepon" placeholder="+62 812..."/></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Kota / Lokasi</label><input type="text" id="lokasi" placeholder="Jakarta, Indonesia"/></div>
      <div class="form-group"><label>LinkedIn / Portfolio</label><input type="text" id="linkedin" placeholder="linkedin.com/in/nama"/></div>
    </div>

    <div class="section-label">Karir</div>
    <div class="form-group"><label>Posisi yang Dituju *</label><input type="text" id="posisi" placeholder="Software Engineer, Marketing Manager, dll."/></div>
    <div class="form-group"><label>Ringkasan Diri (opsional)</label><textarea id="ringkasan" placeholder="Ceritakan tentang diri Anda..."></textarea></div>

    <div class="section-label">Pengalaman Kerja</div>
    <div class="dynamic-list" id="exp-list">
      <div class="dynamic-item"><input type="text" placeholder="2020‚Äì2023 | Software Engineer | PT Maju Jaya"/><button class="btn-remove" onclick="removeItem(this)">√ó</button></div>
    </div>
    <button class="btn-add" onclick="addItem('exp-list','2021‚Äì2024 | Data Analyst | Startup XYZ')">+ Tambah Pengalaman</button>

    <div class="section-label">Pendidikan</div>
    <div class="dynamic-list" id="edu-list">
      <div class="dynamic-item"><input type="text" placeholder="2016‚Äì2020 | S1 Teknik Informatika | Universitas Indonesia"/><button class="btn-remove" onclick="removeItem(this)">√ó</button></div>
    </div>
    <button class="btn-add" onclick="addItem('edu-list','2012‚Äì2016 | SMA Negeri 1 Jakarta')">+ Tambah Pendidikan</button>

    <div class="section-label">Keahlian (Skills)</div>
    <div class="dynamic-list" id="skill-list">
      <div class="dynamic-item"><input type="text" placeholder="JavaScript, Python, React..."/><button class="btn-remove" onclick="removeItem(this)">√ó</button></div>
    </div>
    <button class="btn-add" onclick="addItem('skill-list','Project Management, Komunikasi...')">+ Tambah Skill</button>

    <div class="section-label">Bahasa yang Dikuasai</div>
    <div class="dynamic-list" id="lang-list">
      <div class="dynamic-item"><input type="text" placeholder="Bahasa Indonesia (Native), Inggris (Profesional)"/><button class="btn-remove" onclick="removeItem(this)">√ó</button></div>
    </div>
    <button class="btn-add" onclick="addItem('lang-list','Mandarin (Dasar)')">+ Tambah Bahasa</button>

    <div class="section-label">Sertifikasi (opsional)</div>
    <div class="dynamic-list" id="cert-list">
      <div class="dynamic-item"><input type="text" placeholder="AWS Certified Developer ‚Äì 2022"/><button class="btn-remove" onclick="removeItem(this)">√ó</button></div>
    </div>
    <button class="btn-add" onclick="addItem('cert-list','Google Analytics Certified')">+ Tambah Sertifikasi</button>

    <button class="btn-generate" id="gen-btn" onclick="generateCV()">‚ú¶ Generate CV Sekarang</button>
    <div class="status-msg" id="status-msg"></div>
  </div>

  <div class="cv-panel">
    <div class="panel-title">Preview CV</div>
    <div class="cv-wrapper" id="cv-wrapper">
      <div class="cv-placeholder">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none"><rect x="8" y="4" width="32" height="40" rx="4" stroke="#1a1a2e" stroke-width="2"/><line x1="14" y1="16" x2="34" y2="16" stroke="#1a1a2e" stroke-width="2"/><line x1="14" y1="22" x2="34" y2="22" stroke="#1a1a2e" stroke-width="2"/><line x1="14" y1="28" x2="26" y2="28" stroke="#1a1a2e" stroke-width="2"/></svg>
        <p>CV Anda akan muncul di sini<br>setelah mengisi data dan klik Generate</p>
      </div>
    </div>
    <div class="cv-actions" id="cv-actions" style="display:none">
      <button class="btn-action btn-download" onclick="downloadCV()">‚¨á Download HTML</button>
      <button class="btn-action btn-print" onclick="window.print()">üñ® Print / PDF</button>
    </div>
  </div>
</div>

<script>
let fotoBase64 = null;
let activeTemplate = 1;
let lastCV = null;

function handleFoto(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    fotoBase64 = e.target.result;
    document.getElementById('foto-preview').src = fotoBase64;
    document.getElementById('foto-placeholder').style.display = 'none';
    document.getElementById('foto-preview-wrap').style.display = 'block';
    document.getElementById('btn-hapus-foto').style.display = 'inline-block';
    if (lastCV) renderCV(lastCV);
  };
  reader.readAsDataURL(file);
}

function hapusFoto(e) {
  e.stopPropagation();
  fotoBase64 = null;
  document.getElementById('foto-input').value = '';
  document.getElementById('foto-placeholder').style.display = 'block';
  document.getElementById('foto-preview-wrap').style.display = 'none';
  document.getElementById('btn-hapus-foto').style.display = 'none';
  if (lastCV) renderCV(lastCV);
}

function pilihTemplate(n) {
  activeTemplate = n;
  document.querySelectorAll('.template-card').forEach(c => c.classList.remove('active'));
  document.getElementById('tpl-' + n).classList.add('active');
  if (lastCV) renderCV(lastCV);
}

function addItem(listId, placeholder) {
  const list = document.getElementById(listId);
  const div = document.createElement('div');
  div.className = 'dynamic-item';
  div.innerHTML = `<input type="text" placeholder="${placeholder}"/><button class="btn-remove" onclick="removeItem(this)">√ó</button>`;
  list.appendChild(div);
  div.querySelector('input').focus();
}

function removeItem(btn) {
  const list = btn.closest('.dynamic-list');
  if (list.children.length > 1) btn.closest('.dynamic-item').remove();
}

function getListValues(listId) {
  return Array.from(document.querySelectorAll(`#${listId} input`)).map(i => i.value.trim()).filter(Boolean);
}

function setStatus(msg) {
  const el = document.getElementById('status-msg');
  el.textContent = msg;
  el.classList.add('visible');
}

async function generateCV() {
  const nama = document.getElementById('nama').value.trim();
  const email = document.getElementById('email').value.trim();
  const posisi = document.getElementById('posisi').value.trim();
  if (!nama || !email || !posisi) { setStatus('‚ö† Mohon isi Nama, Email, dan Posisi.'); return; }

  const btn = document.getElementById('gen-btn');
  btn.disabled = true;
  btn.textContent = '‚è≥ AI sedang menulis CV Anda...';
  setStatus('ü§ñ Menghubungi AI...');

  const data = {
    nama, tgl_lahir: document.getElementById('tgl_lahir').value,
    email, telepon: document.getElementById('telepon').value.trim(),
    lokasi: document.getElementById('lokasi').value.trim(),
    linkedin: document.getElementById('linkedin').value.trim(),
    posisi, ringkasan_user: document.getElementById('ringkasan').value.trim(),
    pengalaman: getListValues('exp-list'), pendidikan: getListValues('edu-list'),
    skills: getListValues('skill-list'), bahasa: getListValues('lang-list'),
    sertifikasi: getListValues('cert-list'),
  };

  const prompt = `Anda adalah penulis CV profesional Indonesia. Buat CV dalam format JSON. HANYA kembalikan JSON valid tanpa backtick:
NAMA: ${data.nama}
TANGGAL LAHIR: ${data.tgl_lahir || 'tidak disebutkan'}
EMAIL: ${data.email}
TELEPON: ${data.telepon || 'tidak disebutkan'}
LOKASI: ${data.lokasi || 'tidak disebutkan'}
LINKEDIN: ${data.linkedin || 'tidak disebutkan'}
POSISI: ${data.posisi}
RINGKASAN: ${data.ringkasan_user || 'buatkan 3-4 kalimat profesional'}
PENGALAMAN: ${data.pengalaman.join(' | ') || 'tidak disebutkan'}
PENDIDIKAN: ${data.pendidikan.join(' | ') || 'tidak disebutkan'}
SKILLS: ${data.skills.join(', ') || 'tidak disebutkan'}
BAHASA: ${data.bahasa.join(', ') || 'tidak disebutkan'}
SERTIFIKASI: ${data.sertifikasi.join(', ') || 'tidak ada'}
Format JSON:
{"nama":"","posisi_target":"","email":"","telepon":"","lokasi":"","linkedin":"","usia":"","ringkasan":"","pengalaman":[{"jabatan":"","perusahaan":"","periode":"","deskripsi":["","",""]}],"pendidikan":[{"gelar":"","institusi":"","tahun":""}],"skills":[""],"bahasa":[{"nama":"","level":""}],"sertifikasi":[""]}`;

  try {
    const res = await fetch('/.netlify/functions/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ prompt })
    });
    const apiData = await res.json();
    if (!res.ok) throw new Error(apiData.error || 'Gagal dari server');
    let text = '';
    if (apiData.content && Array.isArray(apiData.content)) {
      text = apiData.content.map(c => c.text || '').join('');
    } else throw new Error('Format response tidak dikenali');
    text = text.replace(/```json|```/g, '').trim();
    const jsonMatch = text.match(/\{[\s\S]*\}/);
    if (!jsonMatch) throw new Error('JSON tidak ditemukan');
    const cv = JSON.parse(jsonMatch[0]);
    lastCV = cv;
    renderCV(cv);
    setStatus('‚úÖ CV berhasil dibuat!');
    document.getElementById('cv-actions').style.display = 'flex';
  } catch (e) {
    console.error(e);
    setStatus('‚ùå Error: ' + e.message);
  } finally {
    btn.disabled = false;
    btn.textContent = '‚ú¶ Generate Ulang CV';
  }
}

function renderCV(cv) {
  const t = activeTemplate;
  const wrapper = document.getElementById('cv-wrapper');
  const fotoHTML = fotoBase64
    ? `<img class="cv-foto" src="${fotoBase64}" alt="Foto">`
    : `<div class="cv-foto-placeholder">üë§</div>`;

  const expHTML = (cv.pengalaman || []).map(e => `
    <div class="cv-exp-item">
      <div class="cv-exp-role">${e.jabatan || ''}</div>
      <div class="cv-exp-company">${e.perusahaan || ''}</div>
      <div class="cv-exp-period">${e.periode || ''}</div>
      <div class="cv-exp-desc">${(e.deskripsi || []).map(d => `‚Ä¢ ${d}`).join('<br>')}</div>
    </div>`).join('');

  const eduHTML = (cv.pendidikan || []).map(e => `
    <div class="cv-edu-item">
      <div class="cv-edu-degree">${e.gelar || ''}</div>
      <div class="cv-edu-school">${e.institusi || ''}</div>
      <div class="cv-edu-year">${e.tahun || ''}</div>
    </div>`).join('');

  const skillHTML = (cv.skills || []).map(s => `<span class="cv-skill-tag">${s}</span>`).join('');
  const langHTML = (cv.bahasa || []).map(l => `<div class="cv-lang-item"><span>${l.nama}</span><span class="cv-lang-level">${l.level}</span></div>`).join('');
  const certHTML = (cv.sertifikasi || []).filter(Boolean).length ? `
    <div class="cv-section">
      <div class="cv-section-title-side">Sertifikasi</div>
      ${(cv.sertifikasi || []).filter(Boolean).map(c => `<div style="font-size:11px;color:#555;margin-bottom:4px">üèÖ ${c}</div>`).join('')}
    </div>` : '';

  wrapper.innerHTML = `
    <div id="cv-content" class="t${t}">
      <div class="cv-header-bar">
        ${fotoHTML}
        <div>
          <div class="cv-name">${cv.nama || ''}</div>
          <div class="cv-title">${cv.posisi_target || ''}</div>
          <div class="cv-contact-bar">
            ${cv.email ? `<div class="cv-contact-item">‚úâ ${cv.email}</div>` : ''}
            ${cv.telepon ? `<div class="cv-contact-item">üìû ${cv.telepon}</div>` : ''}
            ${cv.lokasi ? `<div class="cv-contact-item">üìç ${cv.lokasi}</div>` : ''}
            ${cv.linkedin ? `<div class="cv-contact-item">üîó ${cv.linkedin}</div>` : ''}
            ${cv.usia && cv.usia !== 'tidak disebutkan' ? `<div class="cv-contact-item">üéÇ ${cv.usia}</div>` : ''}
          </div>
        </div>
      </div>
      <div class="cv-body">
        <div>
          ${skillHTML ? `<div class="cv-section"><div class="cv-section-title-side">Keahlian</div><div class="cv-skill-list">${skillHTML}</div></div>` : ''}
          ${eduHTML ? `<div class="cv-section"><div class="cv-section-title-side">Pendidikan</div>${eduHTML}</div>` : ''}
          ${langHTML ? `<div class="cv-section"><div class="cv-section-title-side">Bahasa</div>${langHTML}</div>` : ''}
          ${certHTML}
        </div>
        <div>
          ${cv.ringkasan ? `<div class="cv-section"><div class="cv-section-title">Profil Profesional</div><div class="cv-summary">${cv.ringkasan}</div></div>` : ''}
          ${expHTML ? `<div class="cv-section"><div class="cv-section-title">Pengalaman Kerja</div>${expHTML}</div>` : ''}
        </div>
      </div>
    </div>`;
}

function downloadCV() {
  const content = document.getElementById('cv-content');
  if (!content) return;
  const html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>CV - ${document.getElementById('nama').value}</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Sans:wght@300;400;500;600&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>body{margin:0;color:#1a1a2e}${document.querySelector('style').textContent}</style>
</head><body>${content.outerHTML}</body></html>`;
  const a = document.createElement('a');
  a.href = 'data:text/html;charset=utf-8,' + encodeURIComponent(html);
  a.download = 'CV_' + (document.getElementById('nama').value || 'saya') + '.html';
  a.click();
}
</script>
</body>
</html>
